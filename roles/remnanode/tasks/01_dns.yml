---
- name: Create or update Cloudflare DNS records
  community.general.cloudflare_dns:
    zone: "{{ cloudflare_zone }}"
    record: "{{ node_subdomain }}"
    type: A
    value: "{{ ansible_host | default(inventory_hostname) }}"
    proxied: false
    api_token: "{{ cloudflare_api_token }}"
    state: present
  become: false
  when: node_subdomain is defined

- name: Display DNS configuration
  ansible.builtin.debug:
    msg: "DNS record configured: {{ node_subdomain }}.{{ cloudflare_zone }} -> {{ ansible_host | default(inventory_hostname) }}"
  when: node_subdomain is defined
