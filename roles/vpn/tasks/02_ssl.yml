---
- name: Ensure SSL directory exists
  ansible.builtin.file:
    path: "{{ vpn_path }}/ssl"
    state: directory
    mode: "0755"

- name: Generate self-signed SSL certificate
  ansible.builtin.command: >
    openssl req -x509 -nodes -days 3650
    -newkey rsa:2048
    -keyout {{ ssl_key_path }}
    -out {{ ssl_cert_path }}
    -subj "/CN={{ domain }}"
  args:
    creates: "{{ ssl_cert_path }}"

- name: Set SSL key permissions
  ansible.builtin.file:
    path: "{{ ssl_key_path }}"
    mode: "0600"
